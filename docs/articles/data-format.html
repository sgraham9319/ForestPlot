<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data formatting • ForestPlotR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data formatting">
<meta property="og:description" content="ForestPlotR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ForestPlotR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-format.html">Data formatting</a>
    </li>
    <li>
      <a href="../articles/describe-nbhds.html">Describing neighborhoods</a>
    </li>
    <li>
      <a href="../articles/growth-calc.html">Calculating growth rates</a>
    </li>
    <li>
      <a href="../articles/model-growth.html">Modeling tree growth</a>
    </li>
    <li>
      <a href="../articles/visualizations.html">Visualizing mapped stands</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sgraham9319/ForestPlotR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="data-format_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data formatting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sgraham9319/ForestPlotR/blob/master/vignettes/data-format.Rmd"><code>vignettes/data-format.Rmd</code></a></small>
      <div class="hidden name"><code>data-format.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sgraham9319.github.io/ForestPlot/">ForestPlotR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>This vignette describes how mapped forest stand datasets should be formatted to ensure full compatibility with ForestPlotR and introduces some data checking functions to assist with the formatting process.</p>
<div id="data-file-types" class="section level2">
<h2 class="hasAnchor">
<a href="#data-file-types" class="anchor"></a>Data file types</h2>
<p>The ForestPlotR package expects raw mapped forest stand data to consist of at least two distinct files:</p>
<ol style="list-style-type: decimal">
<li><p>Mapping data - coordinate locations of individual trees within stands</p></li>
<li><p>Tree census data - measurements of individual trees taken during repeated censuses of the stands</p></li>
</ol>
<div id="mapping-data" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping-data" class="anchor"></a>Mapping data</h3>
<p>The mapping dataset should be a data frame where each row represents a unique tree and contains its identifying and location information. The built-in dataset <code>mapping</code> is a cleaned and correctly formatted example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mapping</span><span class="op">)</span>
<span class="co">#&gt;         tree_id stand_id  tag species year  dbh x_coord y_coord</span>
<span class="co">#&gt; 1 AB08000100022     AB08   19    TSHE 2012 15.1   18.11   95.68</span>
<span class="co">#&gt; 2 AB08000100001     AB08 4001    TSHE 2012 50.4   11.78   96.77</span>
<span class="co">#&gt; 3 AB08000100002     AB08 4002    TSHE 2012 81.1   12.47   97.95</span>
<span class="co">#&gt; 4 AB08000100003     AB08 4003    TSHE 2012 20.0   14.94   91.91</span>
<span class="co">#&gt; 5 AB08000100004     AB08 4004    TSHE 2012 53.7   22.09   99.06</span>
<span class="co">#&gt; 6 AB08000100005     AB08 4005    TSHE 2012 24.4   12.16   91.48</span></code></pre></div>
<p>To ensure full compatibility with ForestPlotR functions, the mapping dataset should contain the columns: <code>tree_id</code>, <code>stand_id</code>, <code>tag</code>, <code>species</code>, <code>x_coord</code>, and <code>y_coord</code>. Additional columns can also be included without disrupting function performance and column order is not important. For details on what each required column represents, use <code><a href="../reference/mapping.html">?mapping</a></code>. If only a few functions from ForestPlotR will be applied, some columns in <code>mapping</code> may not be required (e.g. the column <code>tag</code> is only required for <code><a href="../reference/stand_map.html">stand_map()</a></code>) so please read individual function documentation before spending time generating any missing columns.</p>
</div>
<div id="tree-census-data" class="section level3">
<h3 class="hasAnchor">
<a href="#tree-census-data" class="anchor"></a>Tree census data</h3>
<p>The tree census dataset should be a data frame where each row represents the measurement data for a single tree during a specific census of the stand. This means each tree will appear on <em>x</em> rows where <em>x</em> is the number of censuses in which that tree was measured. The required columns are: <code>tree_id</code>, <code>stand_id</code>, <code>species</code>, <code>year</code> and <code>dbh</code>. For details on what each required column represents, use <code><a href="../reference/tree.html">?tree</a></code>. The built-in dataset <code>tree</code> is a cleaned and correctly formatted example:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>
<span class="co">#&gt;         tree_id stand_id  tag species year  dbh</span>
<span class="co">#&gt; 1 AB08000100022     AB08   19    TSHE 2002 15.0</span>
<span class="co">#&gt; 2 AB08000100022     AB08   19    TSHE 2008 15.2</span>
<span class="co">#&gt; 3 AB08000100022     AB08   19    TSHE 2012 15.1</span>
<span class="co">#&gt; 4 AB08000100022     AB08   19    TSHE 2017 15.3</span>
<span class="co">#&gt; 5 AB08000100001     AB08 4001    TSHE 1978 48.2</span>
<span class="co">#&gt; 6 AB08000100001     AB08 4001    TSHE 1984 48.2</span></code></pre></div>
<p>Additional unrequired columns can also be included in the tree census dataset without disrupting function performance (e.g. <code>tag</code> in <code>tree</code>) and column order is not important.</p>
</div>
</div>
<div id="data-checking" class="section level2">
<h2 class="hasAnchor">
<a href="#data-checking" class="anchor"></a>Data checking</h2>
<p>To obtain accurate and useful neighborhood descriptions it is important that the mapping and tree census datasets are cleaned of any unusual or missing data. The ForestPlotR package contains functions to assist with the cleaning process but these functions only highlight cases of missing data rather than automatically removing the associated observations. This is because not all cases of missing data prevent all types of analysis and some missing data can be inferred from data collection records (e.g. missing year of measurement in tree census data).</p>
<div id="mapping_check-check-mapping-datasets" class="section level3">
<h3 class="hasAnchor">
<a href="#mapping_check-check-mapping-datasets" class="anchor"></a><code>mapping_check()</code>: Check mapping datasets</h3>
<p>The built-in dataset <code>messy_mapping</code> contains examples of common data errors in mapping datasets. For instance, there are 10 tree ids that are connected to more than one mapping record:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">messy_mapping</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">tree_id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">count</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;   tree_id       count</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;int&gt;</span>
<span class="co">#&gt; 1 AE10001100015     2</span>
<span class="co">#&gt; 2 AM16000400020     2</span>
<span class="co">#&gt; 3 AM16001200016     2</span>
<span class="co">#&gt; 4 AV02000100011     2</span>
<span class="co">#&gt; # ... with 6 more rows</span></code></pre></div>
<p>The <code><a href="../reference/mapping_check.html">mapping_check()</a></code> function checks a mapping dataset for a variety of common errors and returns a list containing two elements. The first element (<code>$problem_trees</code>) is a data frame containing the rows of the input mapping dataset that contain issues, with an additional final column describing the issue. The arguments “max_x” and “max_y” must be provided so the function can check for x and y coordinates beyond the stand boundary.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">map_issues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapping_check.html">mapping_check</a></span><span class="op">(</span><span class="va">messy_mapping</span>, max_x <span class="op">=</span> <span class="fl">100</span>, max_y <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; [1] "Potential formatting problems detected: please review output and correct errors or remove problem trees if necessary before continuing analysis"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">map_issues</span><span class="op">$</span><span class="va">problem_trees</span><span class="op">)</span>
<span class="co">#&gt;         tree_id stand_id  tag species year  dbh x_coord y_coord</span>
<span class="co">#&gt; 1 TO04000600004     TO04 4476    ABAM 2012 24.3   61.81   67.76</span>
<span class="co">#&gt; 2 AV02000300011     AV02 2045    ABAM 2012 34.6   31.14   90.37</span>
<span class="co">#&gt; 3 AV14001200030     AV14   34    TSHE 2013  5.6   57.20    4.48</span>
<span class="co">#&gt; 4 AV02000100011     AV02 2011    TSHE 2008  8.6    4.22   92.57</span>
<span class="co">#&gt; 5 AV02001300002     AV02 1612    ABAM 2012 23.7   58.51   49.61</span>
<span class="co">#&gt; 6 AM16000400020     AM16 3528    ABAM 2012 37.5   37.62   56.15</span>
<span class="co">#&gt;                issue</span>
<span class="co">#&gt; 1 duplicated tree_id</span>
<span class="co">#&gt; 2 duplicated tree_id</span>
<span class="co">#&gt; 3 duplicated tree_id</span>
<span class="co">#&gt; 4 duplicated tree_id</span>
<span class="co">#&gt; 5 duplicated tree_id</span>
<span class="co">#&gt; 6 duplicated tree_id</span></code></pre></div>
<p>The second element (<code>$issue_summary</code>) is a data frame summarizing the number and percentage of trees in the mapping dataset that have one or more problems and each specific type of problem.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">map_issues</span><span class="op">$</span><span class="va">issue_summary</span><span class="op">)</span>
<span class="co">#&gt;                      issue count       pct</span>
<span class="co">#&gt; 1       at least one issue    71 0.7746018</span>
<span class="co">#&gt; 2 coordinates out of range    26 0.2836570</span>
<span class="co">#&gt; 3       duplicated tree_id    10 0.1090988</span>
<span class="co">#&gt; 4      missing coordinates    15 0.1636483</span>
<span class="co">#&gt; 5          missing species    10 0.1090988</span>
<span class="co">#&gt; 6         missing stand_id    10 0.1090988</span></code></pre></div>
</div>
<div id="tree_check-check-tree-census-datasets" class="section level3">
<h3 class="hasAnchor">
<a href="#tree_check-check-tree-census-datasets" class="anchor"></a><code>tree_check()</code>: Check tree census datasets</h3>
<p>The built-in dataset <code>messy_tree</code> contains examples of common data errors in tree census datasets. For instance, there are 10 tree measurement records that have no dbh information:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">messy_tree</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dbh</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;          tree_id stand_id  tag species year dbh</span>
<span class="co">#&gt; 1  AB08000200006     AB08 4023    TSHE 1990  NA</span>
<span class="co">#&gt; 2  AB08000200008     AB08 4025    TSHE 2012  NA</span>
<span class="co">#&gt; 3  AB08000300029     AB08 8671    ABAM 2012  NA</span>
<span class="co">#&gt; 4  AB08000600020     AB08 4107    THPL 1984  NA</span>
<span class="co">#&gt; 5  AB08000700016     AB08 4130    THPL 2002  NA</span>
<span class="co">#&gt; 6  AB08001500015     AB08 4176    TSHE 2012  NA</span>
<span class="co">#&gt; 7  AB08001600003     AB08 4191    TSHE 1990  NA</span>
<span class="co">#&gt; 8  AB08001600008     AB08 4196    TSHE 1995  NA</span>
<span class="co">#&gt; 9  PP17000600019     PP17 9620    PSME 2013  NA</span>
<span class="co">#&gt; 10 PP17001100021     PP17    4    PIMO 2017  NA</span></code></pre></div>
<p>The <code><a href="../reference/tree_check.html">tree_check()</a></code> function checks a tree census dataset for a variety of common errors. A mapping dataset needs to be supplied to the function so that trees in the tree census data that have no associated mapping can be identified. <code><a href="../reference/tree_check.html">tree_check()</a></code> returns a list containing two elements. The first element (<code>$problem_trees</code>) is a data frame containing the tree ids that were flagged as having a data issue and summarizes the issue.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree_issues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_check.html">tree_check</a></span><span class="op">(</span>tree_data <span class="op">=</span> <span class="va">messy_tree</span>, map_data <span class="op">=</span> <span class="va">mapping</span><span class="op">)</span>
<span class="co">#&gt; [1] "Potential formatting problems detected: please review output and correct errors or remove problem trees if necessary before continuing analysis"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tree_issues</span><span class="op">$</span><span class="va">problem_trees</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   tree_id       issue                   </span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;                   </span>
<span class="co">#&gt; 1 AB08000100012 refers to multiple trees</span>
<span class="co">#&gt; 2 AB08000300005 refers to multiple trees</span>
<span class="co">#&gt; 3 AB08000300020 refers to multiple trees</span>
<span class="co">#&gt; 4 AB08000300024 refers to multiple trees</span>
<span class="co">#&gt; # ... with 2 more rows</span></code></pre></div>
<p>The second element (<code>$issue_summary</code>) is a data frame summarizing the number and percentage of trees in the tree census dataset that have one or more problems and each specific type of problem. Note that a tree id will be flagged if just one of its measurement records contains an issue, so many flagged trees are likely to be usable for most analyses.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tree_issues</span><span class="op">$</span><span class="va">issue_summary</span><span class="op">)</span>
<span class="co">#&gt;                      issue count       pct</span>
<span class="co">#&gt; 1       at least one issue    59 5.7392996</span>
<span class="co">#&gt; 2              missing dbh    10 0.9727626</span>
<span class="co">#&gt; 3 missing measurement year    10 0.9727626</span>
<span class="co">#&gt; 4       missing species id    10 0.9727626</span>
<span class="co">#&gt; 5         missing stand id    10 0.9727626</span>
<span class="co">#&gt; 6          no mapping data    10 0.9727626</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/sgraham9319">Stuart Graham</a>, <a href="https://github.com/arokem">Ariel Rokem</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
