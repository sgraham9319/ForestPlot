<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selecting neighborhood size • forestexplorR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Selecting neighborhood size">
<meta property="og:description" content="forestexplorR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">forestexplorR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-format.html">Data formatting</a>
    </li>
    <li>
      <a href="../articles/describe-nbhds.html">Describing neighborhoods</a>
    </li>
    <li>
      <a href="../articles/growth-calc.html">Calculating growth rates</a>
    </li>
    <li>
      <a href="../articles/model-growth.html">Modeling tree growth and mortality</a>
    </li>
    <li>
      <a href="../articles/nbhd_size.html">Selecting neighborhood size</a>
    </li>
    <li>
      <a href="../articles/visualizations.html">Visualizing mapped stands</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sgraham9319/forestexplorR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="nbhd_size_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Selecting neighborhood size</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sgraham9319/forestexplorR/blob/master/vignettes/nbhd_size.Rmd"><code>vignettes/nbhd_size.Rmd</code></a></small>
      <div class="hidden name"><code>nbhd_size.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sgraham9319.github.io/forestexplorR/">forestexplorR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>This vignette demonstrates how to select an appropriate neighborhood size for modeling tree growth or mortality. The appropriate neighborhood size differs between forest ecosystems, forest successional stages, and tree species, so it is strongly recommended that a sensitivity analysis be conducted for neighborhood size before drawing conclusions.</p>
<div id="using-select_nbhd_size" class="section level2">
<h2 class="hasAnchor">
<a href="#using-select_nbhd_size" class="anchor"></a>Using <code>select_nbhd_size()</code>
</h2>
<p>The <code><a href="../reference/select_nbhd_size.html">select_nbhd_size()</a></code> function fits tree growth or mortality models using a variety of neighborhood sizes to calculate the explanatory neighborhood metrics and quantifies the fit of each model to the training data. Comparing the fit of models based on different neighborhood sizes then permits an informed decision on the neighborhood size to be used in the final analysis.</p>
<p>This process involves the implementation of many forestexplorR functions and therefore <code><a href="../reference/select_nbhd_size.html">select_nbhd_size()</a></code> has many required arguments. First we must provide the neighborhood sizes to try (<code>radii</code>) and the tree species for which we want to try them (<code>focal_sps</code>; independent assessments of neighborhood size are made for each species). In addition, we must provide the tree location data required for identifying neighborhoods (<code>map_data</code>), indicate whether we are fitting a growth or mortality model (<code>model_process</code>), and provide the tree measurement dataset needed to calculate growth rates or provide mortality data (<code>tree_data</code>). We can also optionally provide any stand-level abiotic variables we want to include as covariates in the models (<code>abiotic_data</code>).</p>
<p>We also need to indicate what method <code><a href="../reference/neighborhood_summary.html">neighborhood_summary()</a></code> should use to calculate species-specific tree densities, the maximum x and y coordinates so that trees with neighborhoods overlapping the stand boundary can be identified (<code>max_x</code> and <code>max_y</code>), whether we want these edge trees to be excluded from analysis or have their neighborhood metrics corrected (<code>edge_handling</code>), and (optionally) the number of interactions a neighbor species must be involved in to be treated independently instead of included in the “RARE” group (<code>rare_sps</code>; defaults to 100 interactions if not provided).</p>
<p>The following code shows an example of applying <code><a href="../reference/select_nbhd_size.html">select_nbhd_size()</a></code> to growth models for the species “PSME” and “TSHE” in the built-in mapping data, trying neighborhood sizes of 3, 6, 9, 12, and 15 m in radius. Here, we do not apply edge handling, and therefore trees with neighborhoods overlapping the stand boundary are excluded from analysis.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">size_compare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_nbhd_size.html">select_nbhd_size</a></span><span class="op">(</span>radii <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">15</span>, <span class="fl">3</span><span class="op">)</span>, map_data <span class="op">=</span> <span class="va">mapping</span>,
                                 model_process <span class="op">=</span> <span class="st">"growth"</span>,
                                 tree_data <span class="op">=</span> <span class="va">tree</span>,
                                 abiotic_data <span class="op">=</span> <span class="va">stand_abiotic</span>,
                                 focal_sps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PSME"</span>, <span class="st">"TSHE"</span><span class="op">)</span>,
                                 dens_type <span class="op">=</span> <span class="st">"proportional"</span>,
                                 max_x <span class="op">=</span> <span class="fl">100</span>, max_y <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; [1] "Warning: 139 trees exhibited negative annual growth"</span>
<span class="co">#&gt; [1] "Warning: 139 trees exhibited negative annual growth"</span>
<span class="co">#&gt; [1] "Warning: 139 trees exhibited negative annual growth"</span>
<span class="co">#&gt; [1] "Warning: 139 trees exhibited negative annual growth"</span>
<span class="co">#&gt; [1] "Warning: 139 trees exhibited negative annual growth"</span></code></pre></div>
<p>The output of <code><a href="../reference/select_nbhd_size.html">select_nbhd_size()</a></code> is a list. The first element is a table of the mean square errors of the models based on different neighborhood sizes applied to each of the focal species:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">size_compare</span><span class="op">$</span><span class="va">mse_vals</span>
<span class="co">#&gt;   radius     PSME_mse    TSHE_mse</span>
<span class="co">#&gt; 1      3 0.0005965735 0.002588781</span>
<span class="co">#&gt; 2      6 0.0003472912 0.002130589</span>
<span class="co">#&gt; 3      9 0.0003230661 0.002028809</span>
<span class="co">#&gt; 4     12 0.0003323303 0.001944152</span>
<span class="co">#&gt; 5     15 0.0003093260 0.001909060</span></code></pre></div>
<p>The remaining elements are plots of mean square error vs. neighborhood size for each of the focal species:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">size_compare</span><span class="op">$</span><span class="va">PSME_plot</span></code></pre></div>
<p><img src="nbhd_size_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">size_compare</span><span class="op">$</span><span class="va">TSHE_plot</span></code></pre></div>
<p><img src="nbhd_size_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>To select the most appropriate neighborhood size using these plots, we need to consider two competing priorities. First, we of course want our model to fit the training data well so we want to pick a neighborhood size that results in a low mean square error. However, we also want to include as many focal trees as we can because this gives us greater confidence that our findings will be applicable beyond the sampled stands.</p>
<p>As a larger neighborhood size results in lower mean square error but more focal trees excluded due to their neighborhood overlapping the stand boundary (if <code>edge_handling = FALSE</code>), this decision presents a trade-off. We therefore recommend choosing the neighborhood size that, based on visual observation, lies at the “elbow” of these plots. In the example shown here, we would select 6m as the neighborhood radius for both PSME and TSHE. We would therefore provide 6m as the neighborhood radius to the <code><a href="../reference/neighborhoods.html">neighborhoods()</a></code> function when preparing the data for our final model.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/sgraham9319">Stuart Graham</a>, <a href="https://github.com/arokem">Ariel Rokem</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
